---
interface Props {
  talkId: string;
  title: string;
  speakerName: string;
  speakerId: string;
  typeName: string;
  anchor?: boolean;
}

const {
  talkId,
  title,
  speakerName,
  speakerId,
  typeName,
  anchor = false,
} = Astro.props;
const handle = speakerId.replace(/^@/, "");

const badgeColors: Record<string, string> = {
  Presentation: "bg-blue-100 text-blue-700",
  "Lightning Talk": "bg-amber-100 text-amber-700",
  "Discussion / Panel": "bg-purple-100 text-purple-700",
  Workshop: "bg-emerald-100 text-emerald-700",
};

const baseClass =
  "block rounded-lg border border-border bg-white px-5 py-3 scroll-mt-24 target:ring-2 target:ring-blue-400";
const linkClass = `${baseClass} group/card transition-all hover:shadow-md hover:border-blue-300 hover:bg-blue-50/30`;

const plainTitle = title.replace(/<[^>]*>/g, "");
const titleSize = plainTitle.length > 50 ? "text-sm" : "text-base";
const titleClamp = anchor ? "" : "line-clamp-2";
---

<a
  id={anchor ? talkId : undefined}
  href={anchor ? `#${talkId}` : `/talks#${talkId}`}
  class={linkClass}
>
  <div class="flex items-center gap-3">
    <span
      class="text-primary/40 shrink-0 transition-colors group-hover/card:text-blue-500"
      >&rarr;</span
    >
    <div class="flex-1 min-w-0">
      <span
        class:list={[
          "font-semibold text-gray-900 leading-5",
          titleSize,
          titleClamp,
          !anchor && "h-[2.5rem]",
        ]}
        set:html={title}
      />
      <span
        class="flex items-center gap-1.5 mt-1 text-xs text-gray-500 flex-wrap"
      >
        <span
          class:list={[
            "font-medium px-2 py-0.5 rounded-full whitespace-nowrap",
            badgeColors[typeName] || "bg-gray-100 text-gray-600",
          ]}
        >
          {typeName}
        </span>
        <!-- TODO: browser don't allow nested As, but also this makes me feel dirty -->
        {speakerName} Â· <span
          class="text-blue-600 hover:underline cursor-pointer"
          data-bsky-href={`https://bsky.app/profile/${handle}`}>@{handle}</span
        >
      </span>
    </div>
  </div>
</a>

